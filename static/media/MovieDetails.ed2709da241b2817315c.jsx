import _toConsumableArray from"/home/runner/work/Movie-Mania/Movie-Mania/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js";import _asyncToGenerator from"/home/runner/work/Movie-Mania/Movie-Mania/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js";import _slicedToArray from"/home/runner/work/Movie-Mania/Movie-Mania/node_modules/@babel/runtime/helpers/esm/slicedToArray.js";import _regeneratorRuntime from"/home/runner/work/Movie-Mania/Movie-Mania/node_modules/@babel/runtime/regenerator/index.js";import React from'react';import{useParams,useLocation,useNavigate}from'react-router-dom';import{fetchFilmById,fetchTrailerByMovieId}from'fetchData';import{useState,useEffect}from'react';import{ThreeDots}from'react-loader-spinner';import FsLightbox from'fslightbox-react';import s from'./MovieDetails.module.css';import{ImReply}from'react-icons/im';import{AiFillYoutube}from'react-icons/ai';import{jsx as _jsx}from"react/jsx-runtime";import{jsxs as _jsxs}from"react/jsx-runtime";import{Fragment as _Fragment}from"react/jsx-runtime";var MovieDetails=function MovieDetails(){var location=useLocation()||'';var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isLoading=_useState2[0],setIsLoading=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),toggler=_useState4[0],setToggler=_useState4[1];var _useState5=useState(['']),_useState6=_slicedToArray(_useState5,2),trailerLink=_useState6[0],setTrailerLink=_useState6[1];var navigate=useNavigate();var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),film=_useState8[0],setFilm=_useState8[1];var _useParams=useParams(),movieId=_useParams.movieId;var getGeners=function getGeners(genresArr){var geners=genresArr.map(function(genre){return genre.name;}).join(', ');return geners;};var trailerHandler=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(id){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:fetchTrailerByMovieId(id).then(function(data){var trailers=data.results.filter(function(film){return film.name.includes('Trailer');});var trailersLinks=trailers.map(function(video){return"https://www.youtube.com/embed/".concat(video.key);});trailersLinks.length!==0?setTrailerLink(_toConsumableArray(trailersLinks)):setTrailerLink(['']);}).finally(function(){setToggler(!toggler);});case 1:case"end":return _context.stop();}}},_callee);}));return function trailerHandler(_x){return _ref.apply(this,arguments);};}();useEffect(function(){setIsLoading(true);fetchFilmById(Number(movieId)).then(function(data){setFilm(data);setIsLoading(false);});},[movieId]);var goBack=function goBack(){var _location$state;navigate(((_location$state=location.state)===null||_location$state===void 0?void 0:_location$state.from)||'/');};return/*#__PURE__*/_jsx(_Fragment,{children:isLoading?/*#__PURE__*/_jsx("div",{className:s.loader,children:/*#__PURE__*/_jsx(ThreeDots,{height:"80",width:"80",radius:"9",color:"#ccc",ariaLabel:"three-dots-loading",wrapperStyle:{},wrapperClassName:"",visible:true})}):film&&/*#__PURE__*/_jsxs("div",{style:{backgroundImage:"url(\n              https://image.tmdb.org/t/p/w1280".concat(film.backdrop_path,"\n            )"),backgroundRepeat:'no-repeat',backgroundPosition:'center center',backgroundSize:'cover',display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center'},className:s.movieContainer,children:[/*#__PURE__*/_jsx("div",{className:s.buttonContainer,children:/*#__PURE__*/_jsxs("button",{className:s.goback,type:"button",onClick:goBack,children:[/*#__PURE__*/_jsx(ImReply,{})," Go back"]})}),/*#__PURE__*/_jsxs("div",{className:s.movieContent,children:[film.poster_path?/*#__PURE__*/_jsx("img",{className:s.moviePoster,src:"https://image.tmdb.org/t/p/w500".concat(film.poster_path),alt:film.title}):/*#__PURE__*/_jsx("div",{className:s.noImg}),/*#__PURE__*/_jsxs("div",{className:s.movieInfo,children:[/*#__PURE__*/_jsx("h2",{className:s.movieTitle,children:"".concat(film.title," (").concat(film.release_date.slice(0,4),")")}),/*#__PURE__*/_jsx("p",{className:s.movieText,children:"User score: ".concat(film.vote_average&&parseInt(film.vote_average*10),"%")}),/*#__PURE__*/_jsxs("h3",{className:s.movieSubTitle,children:[film.overview&&'Overview',' ',/*#__PURE__*/_jsx("p",{className:s.movieText,children:film.overview})]}),/*#__PURE__*/_jsxs("h3",{className:s.movieSubTitle,children:[getGeners(film.genres)&&'Genres',/*#__PURE__*/_jsx("p",{className:s.movieText,children:getGeners(film.genres)})]}),/*#__PURE__*/_jsxs("button",{className:s.trailerButton,onClick:function onClick(){return trailerHandler(film.id);},children:[/*#__PURE__*/_jsx(AiFillYoutube,{size:20}),"WATCH TRAILERS"]}),/*#__PURE__*/_jsx(FsLightbox,{toggler:toggler,sources:trailerLink})]})]})]})});};export default MovieDetails;